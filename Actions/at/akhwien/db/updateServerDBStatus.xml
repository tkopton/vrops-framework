<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="updateServerDBStatus" result-type="boolean" api-version="6.0.0" id="a707f6ae-ce3d-4674-a65a-b428e41c1d57" version="0.0.0" allowed-operations="evf" category-name="at.akhwien.db">
  <param n="JDBCString" t="string"><![CDATA[]]></param>
  <param n="DBUser" t="string"><![CDATA[]]></param>
  <param n="DBUserPassword" t="SecureString"><![CDATA[]]></param>
  <param n="deploymentId" t="string"><![CDATA[]]></param>
  <param n="newStatus" t="string"><![CDATA[]]></param>
  <param n="oldStatus" t="string"><![CDATA[]]></param>
  <script encoded="false"><![CDATA[sqlStatement="UPDATE deployment SET " 
		+ "ServerDB_Status ='"+newStatus+"'"
		+ ",vRA_Timestamp = GETDATE()"
		+ " WHERE DeploymentID='" + deploymentId + "'";
		if (oldStatus!=null){
			sqlStatement=sqlStatement+ " and ServerDB_Status='"+oldStatus+"';";
		} else {
			sqlStatement=sqlStatement+";";
		}
System.log(sqlStatement);		
var main = new JDBCConnection();
var con;
try  {
	con = main.getConnection( JDBCString, DBUser, DBUserPassword );
	var stat = con.createStatement();
	var result = stat.execute( sqlStatement );
	stat.close();
	if ( result == 0 )  {
		return true;
	} else  {
		return false;
	}
	
}
catch( ex )  {
	throw "Connection to database failed (Reason: " + ex + ")";
} finally {
	if (con) {
		con.close();
	}
}]]></script>
</dunes-script-module>