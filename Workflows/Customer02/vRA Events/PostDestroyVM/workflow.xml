<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item1" object-name="workflow:name=generic" id="7869de31-e99f-4653-ba1c-9759d5d30854" version="0.1.21" api-version="6.0.0" allowed-operations="evf" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[PostDestroyVM]]></display-name>
  <error-handler name="item20" throw-bind-name="errorCode">
    <position y="254.5" x="205.0"/>
  </error-handler>
  <position y="72.68181818181817" x="65.0"/>
  <input>
    <param name="payload" type="Properties"/>
  </input>
  <attrib name="sourceDatacenter" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="vcvm" type="VC:VirtualMachine" read-only="false">
    <value encoded="n"><![CDATA[__NULL__]]></value>
  </attrib>
  <attrib name="replication" type="boolean" read-only="false">
    <value encoded="n"><![CDATA[false]]></value>
  </attrib>
  <attrib name="AKHCustom" type="boolean" read-only="false">
    <value encoded="n"><![CDATA[false]]></value>
  </attrib>
  <attrib name="deploymentId" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="debugFlag" type="boolean" read-only="false" conf-id="c264b2f1-e638-473e-8e4b-e9f671e2e304" conf-key="EventManagerDebugFlag">
    <value encoded="n"><![CDATA[false]]></value>
    <description><![CDATA[(Optional) if Null it will work as true. False will switch exit without executing]]></description>
  </attrib>
  <attrib name="DBUser" type="string" read-only="false" conf-id="58c3ef46-179e-4056-b74a-7a6a4180c3d8" conf-key="DBUser">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="JDBCString" type="string" read-only="false" conf-id="58c3ef46-179e-4056-b74a-7a6a4180c3d8" conf-key="JDBCString">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="DBUserPassword" type="SecureString" read-only="false" conf-id="58c3ef46-179e-4056-b74a-7a6a4180c3d8" conf-key="DBUserPassword">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="DNSnewStatus" type="string" read-only="false">
    <value encoded="n"><![CDATA[delete]]></value>
  </attrib>
  <attrib name="DBReturn" type="boolean" read-only="false">
    <value encoded="n"><![CDATA[false]]></value>
  </attrib>
  <attrib name="DNSStatusReturn" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="errorCode" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="ip" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="vRAnewStatus" type="string" read-only="false">
    <value encoded="n"><![CDATA[deleted]]></value>
  </attrib>
  <attrib name="CheckDB" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="exclusions" type="Array/string" read-only="false" conf-id="c264b2f1-e638-473e-8e4b-e9f671e2e304" conf-key="EventManagerLoggingExclude">
    <value encoded="n"><![CDATA[__NULL__]]></value>
  </attrib>
  <attrib name="deploymentName" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="vcvmName" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="requestid" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <workflow-note x="160.0" y="245.45454545454544" w="540.0" h="69.0" color="ebebebff">
    <description><![CDATA[Default Error]]></description>
  </workflow-note>
  <workflow-item name="item2" out-name="item9" type="task">
    <display-name><![CDATA[prep]]></display-name>
    <script encoded="false"><![CDATA[temp=payload.machine.properties.get("akh.prettyName");

if ((temp==null)||(temp=="")){
	AKHCustom=false;
} else {
	AKHCustom=true;
	replicationTime=temp.split("&")[0];
	if (replicationTime!="0"){
		//replication=true;
		replication=true;
	} else {
		replication=false;//
	}
	vcvmName = payload.get("machine").get("name");
	vcvm = Server.findAllForType("VC:VirtualMachine", "xpath:name='" + vcvmName + "'")[0];
	
	sourceDatacenter=payload.machine.properties.get("akh.rechenzentrum");
	deploymentId=payload.machine.properties.get("__Cafe.Root.Request.Id");
	requestid=System.getContext().getParameter("__asd_catalogRequestId");
}]]></script>
    <in-binding>
      <bind name="payload" type="Properties" export-name="payload"/>
    </in-binding>
    <out-binding>
      <bind name="sourceDatacenter" type="string" export-name="sourceDatacenter"/>
      <bind name="vcvm" type="VC:VirtualMachine" export-name="vcvm"/>
      <bind name="replication" type="boolean" export-name="replication"/>
      <bind name="AKHCustom" type="boolean" export-name="AKHCustom"/>
      <bind name="deploymentId" type="string" export-name="deploymentId"/>
      <bind name="vcvmName" type="string" export-name="vcvmName"/>
      <bind name="requestid" type="string" export-name="requestid"/>
    </out-binding>
    <position y="82.68181818181817" x="164.5"/>
  </workflow-item>
  <workflow-item name="item4" type="end" end-mode="0">
    <position y="199.95454545454544" x="1064.5"/>
  </workflow-item>
  <workflow-item name="item9" out-name="item15" type="condition" alt-out-name="item10" comparator="0">
    <display-name><![CDATA[AKHCustomization?]]></display-name>
    <script encoded="false"><![CDATA[//Generated by the system, cannot be edited
return (AKHCustom == true) ;]]></script>
    <in-binding>
      <bind name="AKHCustom" type="boolean" export-name="AKHCustom"/>
    </in-binding>
    <condition name="AKHCustom" type="boolean" comparator="0" label="null">false</condition>
    <position y="136.3181818181818" x="164.5"/>
  </workflow-item>
  <workflow-item name="item10" type="end" end-mode="0">
    <position y="199.95454545454544" x="204.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item2" type="link" linked-workflow-id="4442e79f-dc72-49f9-bfcd-9dcf555fe871">
    <display-name><![CDATA[logAllProps]]></display-name>
    <in-binding>
      <bind name="payload" type="Properties" export-name="payload"/>
      <bind name="debugFlag" type="boolean" export-name="debugFlag">
        <description><![CDATA[(Optional) if Null it will work as true. False will switch exit without executing]]></description>
      </bind>
      <bind name="exclusions" type="Array/string" export-name="exclusions"/>
    </in-binding>
    <out-binding/>
    <description><![CDATA[Author: Daniel Langenhan (daniel_langenhan@yahoo.com.au)
http://langenhan.info/software/logallprops.html

This workflow will log the content of a property into the logs (System.log). The property can consists of multiple properties in properties as well as arrays. 
The workflow will also log all system context variables (mostly used with vRA).

The input variable debugFlag can be null. If set to false the workflow is not executed. This can be used to make sure that the logging will only work in a debug situtation. ]]></description>
    <position y="146.3181818181818" x="25.0"/>
  </workflow-item>
  <workflow-item name="item3" out-name="item14" catch-name="item7" throw-bind-name="errorCode" type="link" linked-workflow-id="d8548c21-ddf6-4d7c-9616-c8d967c2e9bc">
    <display-name><![CDATA[getDNSStatus]]></display-name>
    <in-binding>
      <bind name="deploymentId" type="string" export-name="deploymentId"/>
    </in-binding>
    <out-binding>
      <bind name="DNSStatusReturn" type="string" export-name="DNSStatusReturn"/>
    </out-binding>
    <position y="146.3181818181818" x="584.5"/>
  </workflow-item>
  <workflow-item name="item5" out-name="item3" type="task" script-module="at.akhwien.db/updateDNSStatus">
    <display-name><![CDATA[updateDNSStatus]]></display-name>
    <script encoded="false"><![CDATA[//Auto generated script, cannot be modified !
actionResult = System.getModule("at.akhwien.db").updateDNSStatus(JDBCString,DBUser,DBUserPassword,deploymentId,newStatus,oldStatus) ;]]></script>
    <in-binding>
      <bind name="DBUser" type="string" export-name="DBUser"/>
      <bind name="DBUserPassword" type="SecureString" export-name="DBUserPassword"/>
      <bind name="deploymentId" type="string" export-name="deploymentId"/>
      <bind name="newStatus" type="string" export-name="DNSnewStatus"/>
      <bind name="JDBCString" type="string" export-name="JDBCString"/>
      <bind name="oldStatus" type="string" explicitly-not-bound="true" export-name="NULL"/>
    </in-binding>
    <out-binding>
      <bind name="actionResult" type="boolean" export-name="DBReturn"/>
    </out-binding>
    <position y="209.95454545454544" x="444.5"/>
  </workflow-item>
  <workflow-item name="item6" out-name="item11" type="link" linked-workflow-id="7400ccc6-a7aa-42c8-a4a1-4163205cf1b1">
    <display-name><![CDATA[errorMail]]></display-name>
    <in-binding>
      <bind name="errorMessage" type="string" export-name="errorCode"/>
      <bind name="vmhostname" type="string" explicitly-not-bound="true"/>
      <bind name="usage" type="string" explicitly-not-bound="true"/>
      <bind name="desciption" type="string" explicitly-not-bound="true"/>
      <bind name="reservationName" type="string" explicitly-not-bound="true"/>
      <bind name="ip" type="string" explicitly-not-bound="true"/>
      <bind name="gateway" type="string" explicitly-not-bound="true"/>
      <bind name="payload" type="Properties" export-name="payload"/>
      <bind name="deploymentName" type="string" export-name="deploymentName"/>
    </in-binding>
    <out-binding/>
    <position y="209.95454545454544" x="864.5"/>
  </workflow-item>
  <workflow-item name="item0" out-name="item11" catch-name="item6" throw-bind-name="errorCode" type="link" linked-workflow-id="6c766ae6-74da-45c0-bb2c-9bb9405fa60b">
    <display-name><![CDATA[removeIPfromIPAM]]></display-name>
    <in-binding>
      <bind name="deploymentID" type="string" export-name="deploymentId"/>
      <bind name="hostname" type="string" export-name="vcvmName"/>
      <bind name="ip" type="string" export-name="ip"/>
    </in-binding>
    <out-binding/>
    <position y="209.95454545454544" x="724.5"/>
  </workflow-item>
  <workflow-item name="item7" out-name="item14" type="link" linked-workflow-id="7400ccc6-a7aa-42c8-a4a1-4163205cf1b1">
    <display-name><![CDATA[errorMail]]></display-name>
    <in-binding>
      <bind name="errorMessage" type="string" export-name="errorCode"/>
      <bind name="vmhostname" type="string" explicitly-not-bound="true"/>
      <bind name="usage" type="string" explicitly-not-bound="true"/>
      <bind name="desciption" type="string" explicitly-not-bound="true"/>
      <bind name="reservationName" type="string" explicitly-not-bound="true"/>
      <bind name="ip" type="string" explicitly-not-bound="true"/>
      <bind name="gateway" type="string" explicitly-not-bound="true"/>
      <bind name="payload" type="Properties" export-name="payload"/>
      <bind name="deploymentName" type="string" export-name="deploymentName"/>
    </in-binding>
    <out-binding/>
    <position y="209.95454545454544" x="584.5"/>
  </workflow-item>
  <workflow-item name="item11" out-name="item19" type="task" script-module="at.akhwien.db/updatevRAStatus">
    <display-name><![CDATA[updatevRAStatus]]></display-name>
    <script encoded="false"><![CDATA[//Auto generated script, cannot be modified !
actionResult = System.getModule("at.akhwien.db").updatevRAStatus(JDBCString,DBUser,DBUserPassword,deploymentId,newStatus,oldStatus) ;]]></script>
    <in-binding>
      <bind name="JDBCString" type="string" export-name="JDBCString"/>
      <bind name="DBUser" type="string" export-name="DBUser"/>
      <bind name="DBUserPassword" type="SecureString" export-name="DBUserPassword"/>
      <bind name="deploymentId" type="string" export-name="deploymentId"/>
      <bind name="newStatus" type="string" export-name="vRAnewStatus"/>
      <bind name="oldStatus" type="string" explicitly-not-bound="true" export-name="NULL"/>
    </in-binding>
    <out-binding>
      <bind name="actionResult" type="boolean" explicitly-not-bound="true" export-name="NULL"/>
    </out-binding>
    <position y="146.3181818181818" x="864.5"/>
  </workflow-item>
  <workflow-item name="item8" out-name="item12" type="task" script-module="at.akhwien.db/getVraStatusFromDeploymentId">
    <display-name><![CDATA[getVraStatusFromDeploymentId]]></display-name>
    <script encoded="false"><![CDATA[//Auto generated script, cannot be modified !
actionResult = System.getModule("at.akhwien.db").getVraStatusFromDeploymentId(JDBCString,DBUser,DBUserPassword,deploymentId) ;]]></script>
    <in-binding>
      <bind name="JDBCString" type="string" export-name="JDBCString"/>
      <bind name="DBUser" type="string" export-name="DBUser"/>
      <bind name="DBUserPassword" type="SecureString" export-name="DBUserPassword"/>
      <bind name="deploymentId" type="string" export-name="deploymentId"/>
    </in-binding>
    <out-binding>
      <bind name="actionResult" type="string" export-name="CheckDB"/>
    </out-binding>
    <position y="82.68181818181817" x="444.5"/>
  </workflow-item>
  <workflow-item name="item12" out-name="item5" type="condition" alt-out-name="item21" comparator="0">
    <display-name><![CDATA[Early Break?]]></display-name>
    <script encoded="false"><![CDATA[//Generated by the system, cannot be edited
return (CheckDB != null) ;]]></script>
    <in-binding>
      <bind name="CheckDB" type="string" export-name="CheckDB"/>
    </in-binding>
    <condition name="CheckDB" type="string" comparator="3" label="null"/>
    <position y="136.3181818181818" x="444.5"/>
  </workflow-item>
  <workflow-item name="item13" type="end" end-mode="0">
    <position y="72.68181818181817" x="904.5"/>
  </workflow-item>
  <workflow-item name="item14" out-name="item0" type="task" script-module="at.akhwien.db/getIPFromDeploymentId">
    <display-name><![CDATA[getIPFromDeploymentId]]></display-name>
    <script encoded="false"><![CDATA[//Auto generated script, cannot be modified !
actionResult = System.getModule("at.akhwien.db").getIPFromDeploymentId(JDBCString,DBUser,DBUserPassword,deploymentId) ;]]></script>
    <in-binding>
      <bind name="JDBCString" type="string" export-name="JDBCString"/>
      <bind name="DBUser" type="string" export-name="DBUser"/>
      <bind name="DBUserPassword" type="SecureString" export-name="DBUserPassword"/>
      <bind name="deploymentId" type="string" export-name="deploymentId"/>
    </in-binding>
    <out-binding>
      <bind name="actionResult" type="string" export-name="ip"/>
    </out-binding>
    <position y="146.3181818181818" x="724.5"/>
  </workflow-item>
  <workflow-item name="item15" out-name="item18" type="task" script-module="at.akhwien/getDeploymentName">
    <display-name><![CDATA[getDeploymentName]]></display-name>
    <script encoded="false"><![CDATA[//Auto generated script, cannot be modified !
actionResult = System.getModule("at.akhwien").getDeploymentName(payload) ;]]></script>
    <in-binding>
      <bind name="payload" type="Properties" export-name="payload"/>
    </in-binding>
    <out-binding>
      <bind name="actionResult" type="string" export-name="deploymentName"/>
    </out-binding>
    <position y="82.68181818181817" x="304.5"/>
  </workflow-item>
  <workflow-item name="item17" out-name="item16" type="link" linked-workflow-id="7400ccc6-a7aa-42c8-a4a1-4163205cf1b1">
    <display-name><![CDATA[errorMail]]></display-name>
    <in-binding>
      <bind name="payload" type="Properties" export-name="payload"/>
      <bind name="errorMessage" type="string" export-name="errorCode"/>
      <bind name="vmhostname" type="string" explicitly-not-bound="true"/>
      <bind name="usage" type="string" explicitly-not-bound="true"/>
      <bind name="desciption" type="string" explicitly-not-bound="true"/>
      <bind name="reservationName" type="string" explicitly-not-bound="true"/>
      <bind name="ip" type="string" explicitly-not-bound="true"/>
      <bind name="gateway" type="string" explicitly-not-bound="true"/>
      <bind name="deploymentName" type="string" export-name="deploymentName"/>
    </in-binding>
    <out-binding/>
    <position y="264.5" x="444.5"/>
  </workflow-item>
  <workflow-item name="item16" throw-bind-name="errorCode" type="end" end-mode="1">
    <position y="254.5" x="624.5"/>
  </workflow-item>
  <workflow-item name="item18" out-name="item8" type="link" linked-workflow-id="3f3ef0b5-3f29-43e0-8932-57199514ea30">
    <display-name><![CDATA[wait for Lock]]></display-name>
    <in-binding/>
    <out-binding/>
    <position y="146.3181818181818" x="305.0"/>
  </workflow-item>
  <workflow-item name="item19" out-name="item4" type="link" linked-workflow-id="4a60f120-6799-49ab-b5b9-65247bcbb5d7">
    <display-name><![CDATA[releaseLock]]></display-name>
    <in-binding/>
    <out-binding/>
    <position y="146.3181818181818" x="1024.5"/>
  </workflow-item>
  <workflow-item name="item20" out-name="item17" type="link" linked-workflow-id="4a60f120-6799-49ab-b5b9-65247bcbb5d7">
    <display-name><![CDATA[releaseLock]]></display-name>
    <in-binding/>
    <out-binding/>
    <position y="264.5" x="305.0"/>
  </workflow-item>
  <workflow-item name="item21" out-name="item22" type="link" linked-workflow-id="4a60f120-6799-49ab-b5b9-65247bcbb5d7">
    <display-name><![CDATA[releaseLock]]></display-name>
    <in-binding/>
    <out-binding/>
    <position y="82.68181818181817" x="584.5"/>
  </workflow-item>
  <workflow-item name="item22" out-name="item13" type="link" linked-workflow-id="7400ccc6-a7aa-42c8-a4a1-4163205cf1b1">
    <display-name><![CDATA[errorMail]]></display-name>
    <in-binding>
      <bind name="payload" type="Properties" export-name="payload"/>
      <bind name="errorMessage" type="string" export-name="errorCode"/>
      <bind name="vmhostname" type="string" explicitly-not-bound="true" export-name="NULL"/>
      <bind name="usage" type="string" explicitly-not-bound="true" export-name="NULL"/>
      <bind name="desciption" type="string" explicitly-not-bound="true" export-name="NULL"/>
      <bind name="reservationName" type="string" explicitly-not-bound="true" export-name="NULL"/>
      <bind name="ip" type="string" explicitly-not-bound="true"/>
      <bind name="gateway" type="string" explicitly-not-bound="true" export-name="NULL"/>
      <bind name="deploymentName" type="string" export-name="deploymentName"/>
    </in-binding>
    <out-binding/>
    <position y="82.68181818181817" x="725.0"/>
  </workflow-item>
  <presentation>
    <p-param name="payload">
      <desc><![CDATA[payload]]></desc>
    </p-param>
  </presentation>
</workflow>