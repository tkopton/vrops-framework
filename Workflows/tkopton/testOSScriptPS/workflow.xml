<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item1" object-name="workflow:name=generic" id="4220b863-251a-436c-84c9-82fa3afae21a" version="0.0.0" api-version="6.0.0" allowed-operations="evf" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[testOSScriptPS]]></display-name>
  <position y="50.0" x="100.0"/>
  <input>
    <param name="vcVm" type="VC:VirtualMachine"/>
    <param name="username" type="string"/>
    <param name="password" type="SecureString"/>
    <param name="workingDirectory" type="string"/>
    <param name="envVariables" type="string"/>
    <param name="powershellTimeout" type="number"/>
  </input>
  <workflow-item name="item0" type="end" end-mode="0">
    <position y="45.40909090909091" x="384.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item0" type="task">
    <display-name><![CDATA[Scriptable task]]></display-name>
    <script encoded="false"><![CDATA[var guest = System.getModule("com.vmware.pscoe.library.guestops").Guest(vcVm, username, password);
var guestOps = System.getModule("com.vmware.pscoe.library.guestops").GuestOperations(guest);
var logger = System.getModule("com.vmware.pscoe.library.logging").getLogger();


/** 
* PowerShell execute ps command
*/
guestOps.setWorkingDirectory(workingDirectory ? workingDirectory : "");
guestOps.setEnvironment(envVariables ? envVariables : []);
guestOps.setTimeout(powershellTimeout);

try {
	System.log("Executing PS Command");
    var commandResult = guestOps.runCommand("Get-ChildItem 'C:\\tmp' -name", "", "powerShell64"); // supported environments are bash, powerShell and powerShell64
    logger.info("PS command result: " + JSON.stringify(commandResult, null, 2));
}
catch(e) {
	logger.warn(e);
}

System.log("[ tkopton_key01=value01 tkopton_key02=value02 tkopton_key03=value03 ]");]]></script>
    <in-binding>
      <bind name="vcVm" type="VC:VirtualMachine" export-name="vcVm"/>
      <bind name="username" type="string" export-name="username"/>
      <bind name="password" type="SecureString" export-name="password"/>
      <bind name="workingDirectory" type="string" export-name="workingDirectory"/>
      <bind name="envVariables" type="string" export-name="envVariables"/>
      <bind name="powershellTimeout" type="number" export-name="powershellTimeout"/>
    </in-binding>
    <out-binding/>
    <position y="55.40909090909091" x="204.5"/>
  </workflow-item>
  <presentation>
    <p-param name="vcVm">
      <desc><![CDATA[vcVm]]></desc>
    </p-param>
    <p-param name="username">
      <desc><![CDATA[username]]></desc>
    </p-param>
    <p-param name="password">
      <desc><![CDATA[password]]></desc>
    </p-param>
    <p-param name="workingDirectory">
      <desc><![CDATA[workingDirectory]]></desc>
    </p-param>
    <p-param name="envVariables">
      <desc><![CDATA[envVariables]]></desc>
    </p-param>
    <p-param name="powershellTimeout">
      <desc><![CDATA[powershellTimeout]]></desc>
    </p-param>
  </presentation>
</workflow>